<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aprende javascript</title>

    <link rel="stylesheet" href="../../../../00-css/style.css" type="text/css">
    <link rel="stylesheet" href="../../../../00-css/style-window.css" type="text/css">


    <link rel="stylesheet" href="../../../css/style.css" type="text/css">
    <link rel="stylesheet" href="./css/style.css" type="text/css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Audiowide&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap"
        rel="stylesheet">
        <script defer src="../../../../00-js/hora.js"></script>
        <!--Elige uno u otro de los scripts inferiores si quieres trabajar solo con Local o con Local+Session-->
        <!-- <script defer src="../../../../00-js/Con-LocalStorage/menu.js"></script> -->
        <!-- <script defer src="../../../../00-js/Con-SesionStorage/menu.js"></script> -->
        <script defer src="../../../../00-js/Con-indexDB/indexdb.js"></script>
        <script defer src="../../../../00-js/Con-indexDB/menu.js"></script> 

        <script defer src="./js/script.js"></script>
        <script defer src="./js/indexDB.js"></script>

</head>

<body>
    <header>
        <ul>
            <li>Learn</li>
            <li>&</li>
            <li>Play</li>
        </ul>
        <h2>Aprende javascript</h2>
        <div id="date-time"></div>
    </header>
    <nav>
        <div class="icono-escritorio carpeta-nav"><a href="../../../../referencias/index.html"><img src="../../../../img/carpetaCerrada.png"><p>Referencias</p></a></div>
        <div class="icono-escritorio carpeta-nav privado"><a href="../../../../ejercicios/index.html"><img src="../../../../img/carpetaabierta2.png"><p>Ejercicios</p></a></div>
        <div class="icono-escritorio registro-nav publico"><a href="../../../../referencias/index.html"><img src="../../../../img/registro.png"><p>Registro</p></a></div>
        <div class="icono-escritorio login-nav publico"><a href="../../../../referencias/index.html"><img src="../../../../img/login.png"><p>LogIn</p></a></div>

        
                <div class="icono-escritorio user-nav privado"><a href="../../../../userPersonalize/index.html" id="enlaceUsuario"><img src="../../../../img/usuarioDefecto.png" id="fotoUsuario"><p id="usuario"></p></a></div>
        <div class="icono-escritorio logout-nav privado" id="logout"><a href="../../../../index.html" id="enlaceLogout"><img src="../../../../img/logout.png"><p>Cerrar Sesion</p></a></div>
        <div class="icono-escritorio logout-nav admin"><a href="../../../../crudUsuarios/index.html"><img src="../../../../img/exe2.png"><p>Administrar</p></a></div>
        <div class="icono-escritorio privado"><a href="../../../../dragon/index.html"><img src="../../../../img/exe2.png"><p>Dragon Ball Finder</p></a></div>


    </nav>
    <main>
        <div id="window">
            <div id="window-header">
                <a href="../../index.html"><img src="../../../../img/flechaatras.png" class="icono-carpeta atras"></a>
                <p>home/ejercicios/Acceso/indexDB</p>
                <a href="../../../../index.html"><img src="../../../../img/cierre.png" class="icono-carpeta cierre"></a>
            </div>
            <div id="window-main-exercise">
                <h3 id="header-exercise">Ejercicio - Trabajando con indexDB</h3>
                <div id="content-exercise">
                    <form>
                        <div>
                            <label>Nombre y apellidos</label>
                            <input type="text" name="nombre" id="nombre"><br>
                        </div>
                        <div>
                            <label>Nombre de usuario</label>
                            <input type="text" name="usuario" id="usuarioForm"><br>
                        </div>
                        <div>
                            <label>Contraseña</label>
                            <input type="password" name="password" id="password"><br>
                        </div>
                    </form>
                    <div class="botones">
                        <button id="guardar" class="btn">Guardar usuario</button>
                        <button id="leerUno" class="btn">Leer usuario</button>
                        <button id="leerTodos" class="btn">Leer usuarios</button>
                        <button id="borrar" class="btn">Borrar usuario</button>
                    </div>
                    <div id="resultado"></div>
                </div>
                <div id="learn-exercise">
                    <p>IndexDB es el ultimo tipo de almacenamiento que nos ofrece el navegador. Es una base de datos asincrona por lo que para trabajar con ella sera necesario utilizar el patron async/await y promesas</p><br>
                    <p>La forma mas basica de trabajar con indexDB es la siguiente</p><br>
                    <ol>
                        <li>Abrir la base de datos</li>
                        <li>Crear el onjeto de almacenamiento. Similar al concepto de tabla</li>
                        <li>Iniciar una transaccion y hacer algun tipo de peticion</li>
                        <li>Esperar a que se complete la transaccion</li>
                        <li>Trabajar con el objeto resultado</li>
                    </ol>
                    <p>Para abrir la conexion a la base de datos necesitaremos emplear la clase <code>indexedDB</code> y el metodo <code>open</code> que requerira saber el nombre del almacenamiento y su version. Lo que nos devuelve esta operacion se maneja a traves de eventos. Controlaremos tres eventos: <code>onupgradeneeded</code> para crearla por primera vez o si se actuliza la version, compara la version interna con la actual; <code>onerror</code> si no podemos abrir la base de datos; y <code>onsuccess</code> si hemos abierto la base de datos correctamente</p><br>
                    <p>En <code>event.target.result</code> tenemos un puntero a la base de datos. La base de datos podra tener muchos almacenamientos o "tablas" para saber cuales son usamos <code>objectStoreNames</code>. Si la tabla no existe se creara con <code>createObjectStore</code> este nos pedira el nombre de la tabla y el <code>keyPath</code> este keypath le dice cual es la clave primaria de la tabla, todos los objetos que se guarden en la tabla deberan tener un campo que se llame igual que la clave del keyPath y que sera el que se use para acceder a ellos</p><br>
                    <p>Realmente indexdb no almacena la informacion en tabla sino en almacenes de datos llamados <code>object stores</code> una base de datos de indexdb puede tener infinitos alamacenes. Cuando se almacena un valor se le asocia una clave. Las claves pueden ser el keyPath o pueden ser <code>autoIncrement</code></p><br>
                    <p>Una vez abierta la conexion, podemos añadir, borrar o leer informacion del almacen. Todas las funciones que controlen esto deberan ser asincronas ya que deberan abrir la conexion a la base de datos si no esta abierta</p><br>
                    <p>Como es una base de datos asincronas para trabajar con ella hay que emplear promesas ya que trabaja mediante eventos, asi que las operaciones anteriores las implementaran. Cualquier operacion de añadido o de borrado se hara mediante transacciones con el objetivo de mantener la integridad de la base de datos y de llevar el registro</p><br>
                    <p>Para trabajar con transacciones lo primero sera iniciarla con el metodo <code>transaction</code> que recibira el nombre del almacen y la operacion que se va a realizar sobre el (lectura, escritura). Despues seleccionamos el almacen con el que vamos a trabajr y finalmente añadimos el dato. Una buena practica aunque no es necesaria es en este tipo de funciones tener bloques try..catch para controlar mejor donde se producen errores ya que en caso de no tenerlos estos se propagan. Para añadir elementos al almacen usamos el metodo <code>put</code></p><br>
                    <p>Para eliminar un usuario usaremos el metodo <code>detele</code> pasandole la clave a borrar. Ojo como indexdb trabaja asincronamente puede ser que el usuario se borre pero siga apareciendo en el almacen, basta con refrescar el almacen </p><br>
                    <p>Para leer todos usaremos el metodo <code>getAll</code> y para solo un usuario concreto <code>get</code></p><br>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <a href="../../../../index.html" id="inicio">Inicio</a>
        <div id="autor">by Miriam Diaz Plaza</div>
        <div id="sistemaOperativo">AT-SO v1.0</div>
    </footer>


</body>

</html>